{"ast":null,"code":"import { all, call, put, takeLeading, takeEvery, select } from 'redux-saga/effects';\nimport { push, getLocation } from 'connected-react-router';\nimport * as AuthAPIs from '../../apis/auth';\nimport { actions as authActions, selectors as authSelectors, AUTH_REGISTER_USER, AUTH_LOGIN, AUTH_LOGOUT } from '../../reducers/auth';\nexport function* userRegistration({\n  userData\n}) {\n  try {\n    const userResponseData = yield call(AuthAPIs.userRegister, userData);\n    const error = null;\n    if (error) throw error;\n    yield put(authActions.userRegisterSuccess(userResponseData));\n    yield put(authActions.loginSuccess());\n  } catch (error) {\n    yield put(authActions.userRegisterFailed(error));\n  }\n}\n\nfunction* handleLogin({\n  loginValue\n}) {\n  try {\n    const loginData = yield call(AuthAPIs.login, loginValue);\n    const email = loginData.email,\n          password = loginData.password;\n    const userData = yield select(authSelectors.userData);\n    const adminData = yield select(authSelectors.adminData);\n    const emailCompare = email === userData.email || email === adminData.email;\n    const passwordCompare = password === userData.password || password === adminData.password;\n    const isAllowed = emailCompare && passwordCompare;\n    const error = null;\n    if (error) throw error;\n\n    if (isAllowed) {\n      yield put(authActions.loginSuccess());\n    }\n  } catch (error) {\n    yield put(authActions.loginFailed(error));\n  }\n} // function* handleTeacherLogin({ payload }) {\n//   try {\n//     const { email, password } = payload;\n//     const { response, error } = yield call(AuthAPIs.getTeacherToken, email, password);\n//     if (error) throw error;\n//     const { data } = response;\n//     const { user, tokens } = data;\n//     const { access: token, refresh: refreshToken } = tokens;\n//     configToken(token);\n//     yield put(AuthActions.loginSuccess(token, refreshToken, user));\n//   } catch (error) {\n//     yield put(AuthActions.loginFailed(error));\n//   }\n// }\n\n\nfunction* handleLogout() {\n  const location = yield select(getLocation);\n  const pathname = location.pathname;\n\n  if (pathname !== '/login') {\n    yield put(push('/login'));\n  }\n}\n\nexport default function* authSaga() {\n  yield all([takeLeading(AUTH_REGISTER_USER, userRegistration), takeLeading(AUTH_LOGIN, handleLogin), takeEvery(AUTH_LOGOUT, handleLogout)]);\n}","map":{"version":3,"sources":["/Users/mr942/Projects/mini-aspire/src/sagas/auth/authSaga.js"],"names":["all","call","put","takeLeading","takeEvery","select","push","getLocation","AuthAPIs","actions","authActions","selectors","authSelectors","AUTH_REGISTER_USER","AUTH_LOGIN","AUTH_LOGOUT","userRegistration","userData","userResponseData","userRegister","error","userRegisterSuccess","loginSuccess","userRegisterFailed","handleLogin","loginValue","loginData","login","email","password","adminData","emailCompare","passwordCompare","isAllowed","loginFailed","handleLogout","location","pathname","authSaga"],"mappings":"AAAA,SACEA,GADF,EACOC,IADP,EACaC,GADb,EAEEC,WAFF,EAGEC,SAHF,EAGaC,MAHb,QAIO,oBAJP;AAKA,SAASC,IAAT,EAAeC,WAAf,QAAkC,wBAAlC;AACA,OAAO,KAAKC,QAAZ,MAA0B,iBAA1B;AACA,SACEC,OAAO,IAAIC,WADb,EAEEC,SAAS,IAAIC,aAFf,EAGEC,kBAHF,EAIEC,UAJF,EAKEC,WALF,QAMO,qBANP;AAQA,OAAO,UAAUC,gBAAV,CAA2B;AAAEC,EAAAA;AAAF,CAA3B,EAAyC;AAC9C,MAAI;AACF,UAAMC,gBAAgB,GAAG,MAAMjB,IAAI,CAACO,QAAQ,CAACW,YAAV,EAAwBF,QAAxB,CAAnC;AACA,UAAMG,KAAK,GAAG,IAAd;AAEA,QAAIA,KAAJ,EAAW,MAAMA,KAAN;AAEX,UAAMlB,GAAG,CAACQ,WAAW,CAACW,mBAAZ,CAAgCH,gBAAhC,CAAD,CAAT;AACA,UAAMhB,GAAG,CAACQ,WAAW,CAACY,YAAZ,EAAD,CAAT;AACD,GARD,CAQE,OAAOF,KAAP,EAAc;AACd,UAAMlB,GAAG,CAACQ,WAAW,CAACa,kBAAZ,CAA+BH,KAA/B,CAAD,CAAT;AACD;AACF;;AAED,UAAUI,WAAV,CAAsB;AAAEC,EAAAA;AAAF,CAAtB,EAAsC;AACpC,MAAI;AACF,UAAMC,SAAS,GAAG,MAAMzB,IAAI,CAACO,QAAQ,CAACmB,KAAV,EAAiBF,UAAjB,CAA5B;AADE,UAEMG,KAFN,GAE0BF,SAF1B,CAEME,KAFN;AAAA,UAEaC,QAFb,GAE0BH,SAF1B,CAEaG,QAFb;AAGF,UAAMZ,QAAQ,GAAG,MAAMZ,MAAM,CAACO,aAAa,CAACK,QAAf,CAA7B;AACA,UAAMa,SAAS,GAAG,MAAMzB,MAAM,CAACO,aAAa,CAACkB,SAAf,CAA9B;AAEA,UAAMC,YAAY,GAAGH,KAAK,KAAKX,QAAQ,CAACW,KAAnB,IAA4BA,KAAK,KAAKE,SAAS,CAACF,KAArE;AACA,UAAMI,eAAe,GAAGH,QAAQ,KAAKZ,QAAQ,CAACY,QAAtB,IAAkCA,QAAQ,KAAKC,SAAS,CAACD,QAAjF;AACA,UAAMI,SAAS,GAAGF,YAAY,IAAIC,eAAlC;AAEA,UAAMZ,KAAK,GAAG,IAAd;AACA,QAAIA,KAAJ,EAAW,MAAMA,KAAN;;AAEX,QAAIa,SAAJ,EAAe;AACb,YAAM/B,GAAG,CAACQ,WAAW,CAACY,YAAZ,EAAD,CAAT;AACD;AACF,GAhBD,CAgBE,OAAOF,KAAP,EAAc;AACd,UAAMlB,GAAG,CAACQ,WAAW,CAACwB,WAAZ,CAAwBd,KAAxB,CAAD,CAAT;AACD;AACF,C,CAED;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAEA,UAAUe,YAAV,GAAyB;AACvB,QAAMC,QAAQ,GAAG,MAAM/B,MAAM,CAACE,WAAD,CAA7B;AADuB,QAEf8B,QAFe,GAEFD,QAFE,CAEfC,QAFe;;AAIvB,MAAIA,QAAQ,KAAK,QAAjB,EAA2B;AACzB,UAAMnC,GAAG,CAACI,IAAI,CAAC,QAAD,CAAL,CAAT;AACD;AACF;;AAED,eAAe,UAAUgC,QAAV,GAAqB;AAClC,QAAMtC,GAAG,CAAC,CACRG,WAAW,CAACU,kBAAD,EAAqBG,gBAArB,CADH,EAERb,WAAW,CAACW,UAAD,EAAaU,WAAb,CAFH,EAGRpB,SAAS,CAACW,WAAD,EAAcoB,YAAd,CAHD,CAAD,CAAT;AAKD","sourcesContent":["import {\n  all, call, put,\n  takeLeading,\n  takeEvery, select,\n} from 'redux-saga/effects';\nimport { push, getLocation } from 'connected-react-router';\nimport * as AuthAPIs from '../../apis/auth';\nimport {\n  actions as authActions,\n  selectors as authSelectors,\n  AUTH_REGISTER_USER,\n  AUTH_LOGIN,\n  AUTH_LOGOUT,\n} from '../../reducers/auth';\n\nexport function* userRegistration({ userData }) {\n  try {\n    const userResponseData = yield call(AuthAPIs.userRegister, userData);\n    const error = null;\n    \n    if (error) throw error;\n\n    yield put(authActions.userRegisterSuccess(userResponseData));\n    yield put(authActions.loginSuccess());\n  } catch (error) {\n    yield put(authActions.userRegisterFailed(error));\n  }\n}\n\nfunction* handleLogin({ loginValue }) {\n  try {\n    const loginData = yield call(AuthAPIs.login, loginValue);\n    const { email, password } = loginData;\n    const userData = yield select(authSelectors.userData);\n    const adminData = yield select(authSelectors.adminData);\n\n    const emailCompare = email === userData.email || email === adminData.email;\n    const passwordCompare = password === userData.password || password === adminData.password;\n    const isAllowed = emailCompare && passwordCompare;\n\n    const error = null;\n    if (error) throw error;\n\n    if (isAllowed) {\n      yield put(authActions.loginSuccess());\n    }\n  } catch (error) {\n    yield put(authActions.loginFailed(error));\n  }\n}\n\n// function* handleTeacherLogin({ payload }) {\n//   try {\n//     const { email, password } = payload;\n//     const { response, error } = yield call(AuthAPIs.getTeacherToken, email, password);\n\n//     if (error) throw error;\n\n//     const { data } = response;\n//     const { user, tokens } = data;\n//     const { access: token, refresh: refreshToken } = tokens;\n\n//     configToken(token);\n//     yield put(AuthActions.loginSuccess(token, refreshToken, user));\n//   } catch (error) {\n//     yield put(AuthActions.loginFailed(error));\n//   }\n// }\n\nfunction* handleLogout() {\n  const location = yield select(getLocation);\n  const { pathname } = location;\n\n  if (pathname !== '/login') {\n    yield put(push('/login'));\n  }\n}\n\nexport default function* authSaga() {\n  yield all([\n    takeLeading(AUTH_REGISTER_USER, userRegistration),\n    takeLeading(AUTH_LOGIN, handleLogin),\n    takeEvery(AUTH_LOGOUT, handleLogout),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}