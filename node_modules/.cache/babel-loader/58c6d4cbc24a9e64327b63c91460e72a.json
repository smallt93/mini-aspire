{"ast":null,"code":"import { all, call, put, takeLeading, takeEvery, select } from 'redux-saga/effects';\nimport { push, getLocation } from 'connected-react-router';\nimport * as AuthAPIs from '../../apis/auth';\nimport { actions as authActions, selectors as authSelectors, AUTH_REGISTER_USER, AUTH_REGISTER_ADMIN, AUTH_LOGIN, AUTH_LOGOUT } from '../../reducers/auth';\nexport function* userRegistration({\n  userData\n}) {\n  try {\n    const userResponseData = yield call(AuthAPIs.userRegister, userData);\n    const error = null;\n    if (error) throw error;\n    yield put(authActions.userRegisterSuccess(userResponseData));\n    yield put(authActions.loginSuccess());\n  } catch (error) {\n    yield put(authActions.userRegisterFailed(error));\n  }\n}\nexport function* adminRegistration({\n  adminData\n}) {\n  try {\n    const adminResponseData = yield call(AuthAPIs.adminRegister, adminData);\n    const error = null;\n    if (error) throw error;\n    yield put(authActions.adminRegisterSuccess(adminResponseData));\n    yield put(authActions.loginSuccess());\n  } catch (error) {\n    yield put(authActions.adminRegisterFailed(error));\n  }\n}\n\nfunction* handleLogin({\n  loginValue\n}) {\n  try {\n    const loginData = yield call(AuthAPIs.login, loginValue);\n    const email = loginData.email,\n          password = loginData.password;\n    const userData = yield select(authSelectors.getUserData);\n    const adminData = yield select(authSelectors.getAdminData);\n    const emailCompare = email === userData.email || email === adminData.email;\n    const passwordCompare = password === userData.password || password === adminData.password;\n    const isAllowed = emailCompare && passwordCompare;\n    const error = null;\n    if (error) throw error;\n\n    if (isAllowed) {\n      yield put(authActions.loginSuccess());\n    }\n  } catch (error) {\n    yield put(authActions.loginFailed(error));\n  }\n} // function* handleTeacherLogin({ payload }) {\n//   try {\n//     const { email, password } = payload;\n//     const { response, error } = yield call(AuthAPIs.getTeacherToken, email, password);\n//     if (error) throw error;\n//     const { data } = response;\n//     const { user, tokens } = data;\n//     const { access: token, refresh: refreshToken } = tokens;\n//     configToken(token);\n//     yield put(AuthActions.loginSuccess(token, refreshToken, user));\n//   } catch (error) {\n//     yield put(AuthActions.loginFailed(error));\n//   }\n// }\n\n\nfunction* handleLogout() {\n  const location = yield select(getLocation);\n  const pathname = location.pathname;\n\n  if (pathname !== '/login') {\n    yield put(push('/login'));\n  }\n}\n\nexport default function* authSaga() {\n  yield all([takeLeading(AUTH_REGISTER_USER, userRegistration), takeLeading(AUTH_REGISTER_ADMIN, adminRegistration), takeLeading(AUTH_LOGIN, handleLogin), takeEvery(AUTH_LOGOUT, handleLogout)]);\n}","map":{"version":3,"sources":["/Users/mr942/Projects/mini-aspire/src/sagas/auth/authSaga.js"],"names":["all","call","put","takeLeading","takeEvery","select","push","getLocation","AuthAPIs","actions","authActions","selectors","authSelectors","AUTH_REGISTER_USER","AUTH_REGISTER_ADMIN","AUTH_LOGIN","AUTH_LOGOUT","userRegistration","userData","userResponseData","userRegister","error","userRegisterSuccess","loginSuccess","userRegisterFailed","adminRegistration","adminData","adminResponseData","adminRegister","adminRegisterSuccess","adminRegisterFailed","handleLogin","loginValue","loginData","login","email","password","getUserData","getAdminData","emailCompare","passwordCompare","isAllowed","loginFailed","handleLogout","location","pathname","authSaga"],"mappings":"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","sourcesContent":["import {\n  all, call, put,\n  takeLeading,\n  takeEvery, select,\n} from 'redux-saga/effects';\nimport { push, getLocation } from 'connected-react-router';\nimport * as AuthAPIs from '../../apis/auth';\nimport {\n  actions as authActions,\n  selectors as authSelectors,\n  AUTH_REGISTER_USER,\n  AUTH_REGISTER_ADMIN,\n  AUTH_LOGIN,\n  AUTH_LOGOUT,\n} from '../../reducers/auth';\n\nexport function* userRegistration({ userData }) {\n  try {\n    const userResponseData = yield call(AuthAPIs.userRegister, userData);\n    const error = null;\n    \n    if (error) throw error;\n\n    yield put(authActions.userRegisterSuccess(userResponseData));\n    yield put(authActions.loginSuccess());\n  } catch (error) {\n    yield put(authActions.userRegisterFailed(error));\n  }\n}\n\nexport function* adminRegistration({ adminData }) {\n  try {\n    const adminResponseData = yield call(AuthAPIs.adminRegister, adminData);\n    const error = null;\n    \n    if (error) throw error;\n\n    yield put(authActions.adminRegisterSuccess(adminResponseData));\n    yield put(authActions.loginSuccess());\n  } catch (error) {\n    yield put(authActions.adminRegisterFailed(error));\n  }\n}\n\nfunction* handleLogin({ loginValue }) {\n  try {\n    const loginData = yield call(AuthAPIs.login, loginValue);\n    const { email, password } = loginData;\n    const userData = yield select(authSelectors.getUserData);\n    const adminData = yield select(authSelectors.getAdminData);\n\n    const emailCompare = email === userData.email || email === adminData.email;\n    const passwordCompare = password === userData.password || password === adminData.password;\n    const isAllowed = emailCompare && passwordCompare;\n\n    const error = null;\n    if (error) throw error;\n\n    if (isAllowed) {\n      yield put(authActions.loginSuccess());\n    }\n  } catch (error) {\n    \n    yield put(authActions.loginFailed(error));\n  }\n}\n\n// function* handleTeacherLogin({ payload }) {\n//   try {\n//     const { email, password } = payload;\n//     const { response, error } = yield call(AuthAPIs.getTeacherToken, email, password);\n\n//     if (error) throw error;\n\n//     const { data } = response;\n//     const { user, tokens } = data;\n//     const { access: token, refresh: refreshToken } = tokens;\n\n//     configToken(token);\n//     yield put(AuthActions.loginSuccess(token, refreshToken, user));\n//   } catch (error) {\n//     yield put(AuthActions.loginFailed(error));\n//   }\n// }\n\nfunction* handleLogout() {\n  const location = yield select(getLocation);\n  const { pathname } = location;\n\n  if (pathname !== '/login') {\n    yield put(push('/login'));\n  }\n}\n\nexport default function* authSaga() {\n  yield all([\n    takeLeading(AUTH_REGISTER_USER, userRegistration),\n    takeLeading(AUTH_REGISTER_ADMIN, adminRegistration),\n    takeLeading(AUTH_LOGIN, handleLogin),\n    takeEvery(AUTH_LOGOUT, handleLogout),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}